import csv, time, datetime, ast, json
from graphqlclient import GraphQLClient

graphqlUrl = 'https://PALACIO.api.fluentretail.com/graphql'
client = GraphQLClient(graphqlUrl)
client.inject_token("bearer 9fbdc821-b278-4fd1-997c-4d7d1d96df06")



def process(fulfilmentList):

    f = open('out.csv','a')
    f.write('Order ID, Order Ref\n')
    i=0
    for ffId in list(fulfilmentList):
        i=i+1
        print(i)
        query = "query{"
        query += "order(id:\""+str(ffId)+"\"){ref}"
        query += "}"
        response = client.execute(query)
        response = json.loads(response)

        f.write(str(ffId)+',')
        for attribute in response['data']['order']['ref']:
            f.write(str(attribute))

        f.write('\n')
    f.close()

    # with open('output.txt','w') as f:
    #     #f.write("id \t status \t ref \t requestedQuantity \t filledQuantity \t rejectedQuantity")
    #     f.write(str(responseList))


start = time.time()

process([415541,415541,415473,415473,415473,415473,415473,415393,415393,415358,415358,415358,415358,415358,415358,415358,415358,415358,415350,415335,415335,415335,415335,415316,415316,415316,415316,415316,415316,415316,415020,415020,415020,414983,414983,414914,414890,414728,414720,414720,414720,414720,414720,414720,414689,414689,414689,414689,414648,414646,414646,414646,414646,414644,414635,414635,414603,414603,414603,414603,414603,414603,414530,414530,414530,414530,414455,414455,414455,414455,414455,414455,414455,414382,414305,414305,414305,414305,414305,414305,414305,414305,414273,414273,414273,414259,414162,414162,414162,414162,414162,414146,414146,414146,414085,414085,414085,414085,414085,414085,414085,414085,414085,414085,414037,414016,414016,414016,413946,413946,413946,413946,413946,413946,413946,413946,413946,413946,413946,413913,413913,413913,413913,413913,413913,413913,413913,413913,413913,413898,413870,413870,413804,413804,413750,413750,413750,413750,413637,413637,413221,413221,413221,413221,413190,413190,413190,413190,413190,413190,413190,413190,413190,413189,413189,413189,413189,413189,413112,413031,413031,413031,413031,413031,413011,412995,412960,412941,412941,412941,412941,412941,412941,412941,412941,412762,412762,412640,412640,412454,412454,412454,412454,412454,412454,412454,412454,412454,412435,412204,412204,412204,412204,412018,412018,412018,412018,411998,411998,411979,411958,411958,411948,411793,411652,411652,411652,411652,411652,411652,411652,411652,411652,411652,411652,411652,411652,411652,411607,411607,411607,411475,411475,411384,411384,411384,411278,411278,411277,411277,411277,411277,411277,411194,411194,411188,411188,411188,411156,411156,411156,411156,411156,411104,411104,411104,411056,411056,411056,411056,411056,411056,410853,410852,410852,410852,410852,410782,410757,410757,410741,410667,410667,410667,410667,410667,410667,410667,410662,410662,410644,410644,410644,410556,410556,410556,410501,410501,410476,410425,410425,410419,410419,410419,410377,410377,410377,410377,410316,410316,410316,410261,410261,410241,410241,410187,410174,410170,410170,410170,410170,410170,410170,410170,410170,410157,410139,410139,410139,410139,410076,410076,410076,410036,410036,410036,410036,409974,409974,409974,409974,409974,409935,409935,409926,409926,409926,409736,409736,409736,409736,409686,409686,409566,409566,409566,409566,409441,409375,409375,409375,409298,409298,409298,409298,409298,409287,409249,409249,409249,409249,409249,409240,409240,409240,409240,409240,409240,409240,409170,409170,409170,409154,409154,409154,409154,409154,409150,409140,409140,409126,409126,409126,409061,409061,409025,409009,408986,408986,408986,408986,408928,408928,408724,408724,408724,408693,408693,408664,408664,408664,408664,408664,408664,408649,408649,408611,408611,408576,408426,408335,407957,407781,407354,407191,407191,406957,406911,406784,406399,406283,406283,406283,406205,405909,405875,405795,405721,405660,405614,405601,405599,405324,405200,405200,405155,405155,405072,405072,405072,405072,405072,405072,405072,405072,404945,404945,404857,404820,404741,404271,403920,403781,403755,403466,403315,403105,403079,402905,402808,402494,402122,401976,401974,401951,401951,401896,401886,401886,401886,401886,401886,401886,401783,401760,401757,401725,401725,401725,401725,401063,400822,400755,400755,400696,400690,400614,400593,400381,400178,400168,400130,400000,399772,399772,399755,399755,399741,399720,399034,398466,397905,397905,397905,397839,397340,397265,397173,397152,397020,396978,396603,396502,396466,396344,396318,396296,396267,396240,396229,396115,396046,395958,395951,395876,395745,395693,395654,395654,395623,395463,395408,395401,395372,395306,395117,395007,394976,394976,394976,394976,394976,394955,394924,394735,394534,394514,394399,394341,394061,394061,394040,394040,393848,393832,393775,393721,393699,393698,393698,393698,393692,393653,393652,393635,393631,393613,393595,393593,393593,393593,393593,393593,393564,393564,393564,393564,393489,393404])

print("Time taken: " + str((time.time()-start)/60) + " minutes")

import json, csv, requests, time
from graphqlclient import GraphQLClient
from http.client import IncompleteRead
from datetime import datetime, timedelta


accountId = 'PALACIO'
oauth_url = 'https://palacio.api.fluentretail.com:443/oauth/token?username=elpalaciodehierro_admin&password=GT8Y4Q&client_id=PALACIO&client_secret=44f824ad-eb5d-4936-af10-86ebbcf5be61&grant_type=password&scope=api'

graphql_url = 'https://PALACIO.api.fluentretail.com/graphql'


def get_token():
    auth_token_response = requests.post(oauth_url)
    if auth_token_response.status_code != 200:
        print("Couldn't get auth token {}".format(auth_token_response.status_code))
    access_token = 'bearer ' + auth_token_response.json()['access_token']
    #print("Access token: {}".format(access_token))
    return access_token



with open('testing.csv','a') as f, open('output.csv','a') as output:

    f.write('S.No, Order Id, SKU Refs, Fulfilment ID, ff Status, SKU REFS, Result\n')
    output.write('Order Id, Status, CreatedOn, SKU Refs, Required Quantity, Price\n')

    def get_all_data():

        inputIdList = [1268110,1267267,1268107,1268104,1268085,1268083,1268063,1268061,1268055,1268037,1268018,1268005,1267983,1267979,1267977,1267971,1267968,1267941,1267931,1267929,1267920,1267905,1267905,1267894,1267879,1267868,1267854,1267846,1267821,1267810,1267799,1267779,1267778,1267776,1267769,1267756,1267750,1267744,1267729,1267718,1267708,1267700,1267697,1267677,1267674,1267665,1267659,1267650,1267649,1267644,1267629,1267535,1267525,1267518,1266875,1267496,1267484,1267477,1267419,1267413,1267412,1267391,1267373,1267356,1267355,1267349,1267344,1267326,1267305,1267302,1267269,1267260,1267257,1267242,1267240,1267224,1267212,1267208,1267203,1267197,1267194,1267143,1267133,1267113,1267107,1267102,1267087,1267086,1267056,1267045,1267038,1267035,1267015,1267007,1266997,1266976,1266945,1266914,1266913,1266908,1266899,1266878,1266875,1266873,1266867,1266861,1266854,1266830,1266799,1266775,1266768,1266760,1266755,1266741,1266726,1266719,1266699,1266699,1266688,1266670,1266659,1266648,1266624,1266622,1266606,1266605,1266580,1266576,1266563,1266562,1266555,1266538,1266489,1266458,1266450,1266434,1266427,1266420,1266419,1266412,1266407,1266372,1266367,1266358,1266338,1266338,1266334,1266311,1266307,1266309,1266270,1266245,1266225,1266213,1266207,1266198,1266163,1266163,1266163,1266132,1266123,1266117,1266111,1266096,1266065,1266043,1266039,1266025,1266002,1265992,1265984,1265983,1265972,1265961,1265950,1265949,1265926,1265911,1265909,1265903,1265876,1265866,1265846,1265824,1265816,1265811,1265793,1265788,1265782,1265743,1265743,1265743,1265721,1265709,1265704,1265683,1265679,1265678,1265662,1265661,1265622,1265601,1265601,1265600,1265596,1265584,1265578,1265577,1265550,1265549,1265533,1265531,1265522,1265505,1265470,1265461,1265451,1265425,1265425,1265425,1265409,1265347,1265339,1265319,1265302,1265296,1265296,1265296,1265291,1265278,1265244,1265216,1265211,1265199,1265178,1265178,1265169,1265137,1265110,1265105,1265093,1265093,1265072,1265069,1265026,1265009,1265009,1265003,1265000,1264994,1264988,1264972,1264966,1264966,1264953,1264943,1264943,1264943,1264926,1264926,1264924,1264924,1264924,1264920,1264918,1264891,1264867,1264863,1264857,1264853,1264839,1264822,1264740,1264650,1264642,1264587,1264584,1264529,1264510,1264497,1264465,1264458,1264427,1264400,1264368,1264358,1264345,1264337,1264333,1264333,1264323,1264302,1264292,1264279,1264275,1264212,1264209,1264186,1264120,1264115,1264116,1264067,1264040,1264034,1264029,1264008,1264003,1263987,1263982,1263968,1263962,1263928,1263891,1263835,1263759,1263720,1263698,1263627,1263617,1263609,1263605,1263576,1262891,1263513,1263513,1263480,1263452,1263431,1263415,1263380,1263365,1263362,1263362,1263348,1263336,1263260,1263222,1263167,1263125,1263114,1263114,1263106,1263077,1262999,1262979,1262979,1262979,1262955,1262946,1262920,1262920,1262916,1262916,1262912,1262869,1262840,1262839,1262837,1262816,1262790,1262765,1262754,1262754,1262754,1262754,1262751,1262731,1262731,1262727,1262724,1262694,1262681,1262679,1262257,1262577,1262572,1262517,1262506,1262505,1262479,1262471,1262469,1262454,1262408,1262408,1262400,1262399,1262332,1262327,1262252,1262245,1262241,1262236,1260510,1262221,1262197,1262195,1262186,1262162,1262124,1262119,1262077,1262061,1262058,1262035,1262023,1262005,1262002,1261975,1261960,1261951,1261941,1261931,1261900,1261900,1261900,1261895,1261857,1261838,1261830,1261827,1261827,1261813,1261787,1261786,1261744,1261729,1261727,1261718,1261717,1261714,1261714,1261696,1261678,1261665,1261647,1261605,1261599,1261583,1261564,1259792,1261556,1261552,1261548,1261518,1261496,1261481,1261481,1261473,1261469,1261465,1261458,1261410,1261389,1261388,1261374,1261374,1261369,1261361,1261359,1261349,1261347,1261331,1261272,1261254,1261244,1261242,1261230,1261229,1261165,1261147,1261111,1261054,1261054,1260996,1260988,1260966,1260957,1260938,1260935,1260910,1260910,1260909,1260888,1260869,1260868,1260841,1260840,1260838,1260830,1260829,1260806,1260798,1260784,1260737,1260664,1260660,1260660,1260646,1260614,1260613,1260600,1260600,1260594,1260565,1260534,1260495,1260474,1260449,1260443,1260383,1260372,1260370,1260364,1260351,1260330,1260328,1260300,1260266,1260264,1260253,1260230,1260203,1260172,1260168,1260160,1260156,1260150,1260140,1260138,1260129,1260123,1260096,1260092,1260091,1260089,1260084,1260077,1260068,1260068,1260068,1260031,1260020,1260013,1259993,1259993,1259993,1259945,1259937,1259906,1259901,1259867,1259863,1259832,1259805,1259795,1259786,1259686,1259668,1259656,1259637,1259612,1259602,1259568,1259538,1259537,1259534,1259533,1259485,1259464,1259436,1259416,1259404,1259395,1259395,1259371,1259366,1259363,1259310,1259297,1259292,1259281,1259263,1259257,1259240,1259231,1259212,1259201,1259187,1259181,1259175,1259159,1259144,1259143,1259116,1259111,1259103,1259103,1259085,1259075,1258776,1259052,1259028,1259013,1259001,1258988,1258980,1258949,1258933,1258933,1258933,1258931,1258912,1258893,1258863,1258776,1258837,1258845,1258834,1258828,1258817,1258806,1258805,1258777,1258776,1258776,1258762,1258752,1258751,1258747,1258734,1258696,1258695,1258684,1258678,1258680,1258672,1258665,1258652,1258649,1258612,1258595,1258583,1258581,1258576,1258569,1258550,1258536,1258536,1258536,1258536,1258536,1258536,1258518,1258440,1258365,1258342,1258336,1258313,1258295,1258290,1258270,1258231,1258226,1258214,1258213,1258205,1258191,1258166,1258149,1258134,1258108,1258097,1258086,1258082,1258075,1258061,1258061,1258002,1257984,1257919,1257083,1257889,1257874,1257846,1257819,1257817,1257809,1257752,1257738,1257733,1257727,1257707,1257694,1257677,1257663,1257660,1257657,1257648,1257562,1257550,1257540,1257536,1257501,1257478,1257420,1257389,1257385,1257385,1257368,1257338,1257315,1257300,1257282,1257266,1257256,1257254,1257202,1257193,1257152,1257117,1257112,1257110,1257106,1257095,1257083,1257078,1257074,1257069,1257055,1257011,1256954,1256944,1256876,1256849,1256833,1256783,1256765,1256764,1256746,1256719,1256719,1256715,1256689,1256645,1256625,1256605,1256596,1256577,1256522,1256522,1256522,1256512,1256493,1256489,1256450,1256421,1256399,1256394,1256366,1256327,1256279,1256260,1256241,1256217,1256189,1256178,1252008,1256159,1256091,1256068,1256008,1255984,1255983,1255969,1255961,1255927,1255922,1255889,1255859,1255824,1255800,1255791,1255783,1255782,1255772,1255758,1255734,1255711,1255653,1255643,1255635,1255634,1255592,1255583,1255580,1255576,1255573,1255566,1255545,1255538,1255512,1255467,1255454,1255444,1255413,1255403,1255388,1255354,1255348,1255337,1255322,1255297,1255272,1255258,1255227,1255209,1255178,1255164,1255162,1255149,1255140,1255137,1255135,1255127,1255123,1255116,1255054,1255043,1255035,1255029,1255022,1254965,1254965,1254934,1254934,1254934,1254934,1254880,1254878,1254834,1254832,1254745,1254679,1254678,1254654,1254612,1254571,1254565,1254517,1254513,1254408,1254406,1254390,1254388,1254374,1254306,1254299,1254226,1254191,1254191,1254183,1254145,1254130,1254123,1254076,1254055,1254043,1254015,1254008,1254008,1254008,1254008,1254008,1254008,1254008,1254002,1253991,1253979,1253975,1253974,1253921,1253872,1253862,1253829,1253778,1253769,1253759,1253759,1253742,1253738,1253675,1253639,1253628,1253624,1253608,1253608,1253608,1253604,1253552,1253552,1252590,1253450,1253432,1253415,1253407,1253378,1253372,1253371,1253370,1253313,1253292,1253290,1253287,1253282,1253282,1253273,1253262,1253214,1253200,1253181,1253179,1253171,1253171,1253148,1253144,1253127,1253108,1253107,1253097,1253097,1253097,1253096,1253079,1253072,1252982,1252982,1252982,1252911,1252891,1252873,1252862,1252826,1252796,1252748,1252745,1252742,1252741,1252705,1252690,1252647,1252626,1252595,1252575,1252555,1252546,1252528,1252489,1252484,1252470,1252455,1252452,1252442,1252412,1252377,1252340,1252316,1252303,1252301,1252283,1252273,1252267,1252250,1252246,1252238,1252222,1252191,1252177,1252169,1252141,1252120,1252106,1252102,1252078,1252067,1252048,1252038,1252008,1252006,1252004,1251998,1251983,1251975,1251974,1251929,1251920,1251894,1251886,1251883,1251881,1251871,1251838,1251827,1251816,1251814,1251805,1251781,1251759,1251750,1251738,1251715,1251706,1251698,1251696,1251687,1251674,1251673,1251666,1251663,1251659,1251631,1251587,1251585,1251582,1251564,1251554,1251530,1251526,1251520,1251478,1251437,1251430,1251429,1251388,1251375,1251375,1251368,1251365,1251351,1251317,1251305,1251271,1251259,1251252,1251248,1251231,1251185,1251182,1251155,1251145,1251110,1251107,1251087,1251071,1251064,1251062,1251019,1250996,1250934,1250934,1250921,1250920,1250907,1250885,1250882,1250849,1250821,1250813,1250806,1250774,1250681,1250636,1250631,1250619,1250564,1250555,1250541,1250524,1250500,1250436,1250426,1250425,1250420,1250404,1233517,1250366,1250320,1250308,1250286,1250263,1250261,1250249,1250226,1250209,1250134,1250129,1250129,1250129,1250129,1250127,1250120,1250097,1250084,1250070,1250047,1250016,1249975,1249969,1249967,1249951,1249943,1249921,1249889,1249868,1249860,1249854,1249816,1249787,1249782,1248297,1249734,1249734,1249720,1249720,1249697,1249488,1249656,1249653,1249643,1249643,1249633,1249625,1249617,1249606,1249535,1249530,1249523,1249518,1249516,1249507,1249488,1249480,1249428,1249417,1249409,1249393,1249360,1249359,1249342,1249309,1249289,1249278,1249261,1249260,1249253,1249156,1249113,1249104,1249057,1249039,1249037,1249015,1248996,1248994,1248993,1248978,1248974,1248970,1248930,1248903,1248890,1248888,1248859,1248853,1248814,1248785,1248772,1248756,1248747,1248741,1248730,1248716,1248695,1248680,1248586,1248569,1248524,1248523,1248520,1248511,1248477,1248459,1248459,1248425,1248423,1248421,1248410,1248356,1248347,1248304,1248297,1248297,1248297,1248297,1246642,1248278,1247899,1248248,1248216,1248200,1248179,1248170,1248146,1248068,1248054,1248041,1248032,1248002,1247999,1247993,1247982,1247954,1247922,1247918,1247903,1247901,1247848,1247815,1247811,1247811,1247811,1247806,1247802,1247787,1247783,1247750,1247730,1247723,1247715,1247715,1247692,1247661,1247652,1247614,1247599,1247577,1247568,1247546,1247456,1247456,1247442,1247440,1247296,1247281,1247242,1247213,1247160,1247159,1247145,1247143,1247106,1247066,1247062,1247058,1247049,1247046,1247042,1246988,1246987,1246973,1246957,1246948,1246940,1246940,1246889,1246834,1246824,1246798,1246786,1246763,1246762,1246752,1246726,1246703,1246702,1246683,1246634,1246600,1245029,1243925,1246587,1241226,1246555,1246550,1246544,1246529,1246524,1246516,1246504,1246490,1246466,1246447,1243505,1244925,1246441,1246424,1246411,1246389,1246381,1246345,1246316,1246291,1246288,1246278,1246257,1246254,1246228,1246196,1246153,1246140,1246069,1246062,1246055,1246048,1245999,1245987,1245977,1245970,1245936,1245904,1245876,1245875,1245868,1245832,1245828,1245816,1245806,1245799,1245790,1245790,1245786,1245776,1245745,1245738,1245719,1245714,1245697,1245692,1245687,1245672,1245620,1245620,1245620,1245616,1245572,1245571,1245557,1245544,1245544,1245485,1245450,1245408,1245408,1245408,1245400,1245391,1245389,1245389,1245373,1245361,1245324,1245324,1245324,1245322,1245320,1245318,1245316,1245294,1245288,1245282,1245234,1245172,1245153,1245153,1245153,1245150,1245141,1245119,1245119,1245118,1245113,1245071,1245061,1245046,1245034,1245020,1245016,1245007,1244988,1244986,1244982,1244969,1244957,1244922,1244915,1244891,1244877,1244877,1244877,1244876,1244856,1244856,1244856,1244856,1244851,1243995,1244850,1244827,1244819,1244778,1244765,1244765,1244758,1244741,1244736,1244720,1244683,1244661,1244660,1244655,1244648,1244641,1244638,1244624,1244620,1244612,1244600,1244596,1244595,1244583,1244582,1244581,1244576,1244575,1244574,1244564,1244562,1244557,1244557,1244557,1244557,1244551,1244550,1244521,1244492,1244485,1244485,1244484,1244481,1244461,1244456,1244441,1244414,1244411,1244382,1244377,1244373,1244373,1244373,1244374,1244372,1244368,1244361,1244359,1244334,1244333,1244324,1244295,1244291,1244280,1244212,1244212,1244212,1244206,1244206,1244206,1244192,1244165,1244163,1244148,1244124,1244113,1244083,1244072,1244071,1244065,1244054,1244040,1244027,1243980,1243952,1243939,1243883,1243882,1243879,1243875,1243875,1243875,1243854,1243849,1243833,1243817,1243796,1243780,1243777,1243775,1243772,1243763,1243742,1243738,1243709,1243707,1243690,1243682,1243682,1243676,1243656,1243652,1243649,1243647,1243601,1243595,1243572,1243565,1243563,1243554,1243550,1243535,1243526,1243513,1243476,1243475,1243475,1243463,1243426,1243419,1243412,1243411,1243400,1243399,1243393,1243378,1243350,1243330,1243324,1243318,1243306,1243299,1243294,1243226,1243214,1243205,1243188,1243179,1243167,1243165,1243124,1243114,1243112,1243105,1243095,1243092,1243088,1243036,1243029,1242998,1242996,1242965,1242958,1242930,1242930,1242930,1242930,1242930,1242923,1242876,1242868,1242205,1242845,1242844,1242838,1242822,1242812,1242790,1242749,1242740,1242740,1242740,1242712,1242709,1242702,1242697,1242690,1242628,1242626,1242612,1242608,1242585,1242582,1242563,1242562,1242526,1242525,1242487,1242472,1242471,1242446,1242429,1242343,1242322,1242321,1242321,1242274,1242260,1242232,1242229,1242218,1242207,1242205,1242199,1242199,1242195,1242195,1242191,1242189,1242159,1242157,1242131,1242124,1242107,1242107,1242104,1242074,1242074,1242060,1242060,1242060,1242060,1242052,1242034,1242030,1242030,1242025,1242024,1242010,1242009,1241987,1241943,1241934,1241878,1241872,1241864,1241853,1241850,1241837,1241815,1241813,1241810,1241763,1241757,1241755,1241701,1241689,1241670,1241664,1241663,1241649,1241634,1241628,1241591,1241581,1241578,1241570,1241504,1241478,1241476,1241471,1241471,1241463,1241452,1241436,1241436,1241436,1241427,1241425,1241404,1241398,1241391,1241390,1241383,1241363,1241353,1241348,1241317,1241316,1241301,1241299,1241299,1241287,1241285,1241276,1241267,1241222,1241217,1241214,1241210,1238539,1241206,1241191,1241169,1241162,1241162,1241162,1241107,1241101,1241086,1241079,1241069,1241069,1241063,1241062,1241031,1241014,1241010,1240980,1240967,1240947,1240942,1240938,1240937,1240933,1240930,1240911,1240910,1240899,1240868,1240866,1240851,1240838,1240836,1240833,1240806,1240802,1240802,1240802,1240776,1240775,1240767,1240755,1240731,1240692,1240689,1240684,1240682,1240652,1240619,1240608,1240575,1240565,1240540,1240523,1240499,1240478,1240469,1240458,1240439,1240427,1240424,1240396,1240385,1240378,1240361,1240358,1240357,1240308,1240293,1240266,1240264,1240251,1240240,1240240,1240240,1240223,1240216,1240215,1240209,1240203,1240196,1240195,1240166,1240163,1240144,1240138,1240124,1240122,1240113,1240113,1240113,1240112,1240038,1240019,1240017,1240009,1239998,1239979,1239973,1239972,1239967,1239949,1239936,1239929,1239923,1239923,1239917,1239892,1239880,1239864,1239864,1239859,1239852,1239796,1239791,1239786,1239776,1239758,1239754,1239750,1239739,1239729,1239696,1239666,1239664,1239628,1239628,1239621,1239608,1239577,1239545,1239540,1239520,1239516,1239485,1239471,1239457,1239438,1239436,1239413,1239407,1239396,1239394,1239385,1239381,1239365,1239365,1239325,1239319,1239313,1239310,1239294,1239284,1239274,1239274,1239267,1239261,1239246,1239231,1239229,1239207,1239198,1239187,1239185,1239163,1239149,1233841,1239140,1239136,1239119,1239108,1239108,1239092,1239084,1239069,1239044,1239020,1239016,1239015,1239008,1238998,1238997,1238675,1238941,1238941,1238919,1238917,1238901,1238893,1238870,1238825,1238811,1238798,1238785,1238779,1238772,1238754,1238742,1238724,1238708,1238701,1238695,1238686,1238675,1238655,1238651,1238645,1238645,1238618,1238608,1238606,1238593,1238552,1238552,1238552,1238539,1238530,1238466,1238463,1238456,1238446,1238442,1238434,1238427,1238425,1238423,1238398,1238371,1238367,1238357,1238338,1238337,1238330,1238326,1238305,1238303,1238292,1238286,1238258,1238256,1238217,1238209,1238208,1238207,1238204,1238191,1238188,1238184,1238181,1238173,1238161,1238159,1238136,1238125,1238124,1238093,1238088,1238071,1238062,1238057,1238047,1238034,1238031,1238018,1237998,1237971,1237948,1237935,1237916,1237910,1237897,1237892,1237878,1237826,1237819,1237808,1237807,1237789,1237782,1237781,1237773,1237759,1237755,1237748,1237741,1237733,1237723,1237720,1237685,1237683,1237677,1237660,1237607,1237566,1237556,1237543,1237504,1237500,1237487,1237470,1237463,1237458,1237431,1237408,1237399,1237394,1237367,1237366,1237356,1237355,1237347,1237338,1237338,1237330,1237292,1237283,1237283,1237283,1237281,1237264,1237233,1237231,1237214,1237206,1237192,1237189,1237177,1237175,1237139,1237128,1237128,1237128,1235706,1237100,1237070,1237064,1237062,1237047,1237022,1237013,1236954,1234809,1236940,1236938,1236935,1236931,1236924,1236923,1236907,1236902,1236898,1236896,1236872,1236870,1236844,1236828,1236820,1236807,1236803,1236792,1236783,1236779,1236769,1236751,1236730,1236728,1236692,1236687,1236677,1236666,1236666,1236664,1236659,1236638,1236622,1236619,1236611,1236570,1236566,1236541,1236499,1236495,1236492,1236476,1236446,1236419,1236417,1236414,1236398,1236395,1236385,1236367,1236367,1236358,1236331,1236324,1236302,1236295,1236269,1236268,1236242,1236220,1236220,1236197,1236182,1236174,1236173,1236162,1236125,1236104,1236068,1236025,1236023,1236021,1236003,1235975,1235943,1235919,1235898,1235893,1235893,1235890,1235875,1235852,1235848,1235846,1235826,1235826,1235825,1235781,1235743,1235708,1235696,1235693,1235652,1235639,1235622,1235606,1235534,1235467,1235445,1235406,1235376,1235363,1235353,1235341,1235341,1235330,1235318,1235317,1235285,1235282,1235248,1235234,1235225,1235173,1235156,1235138,1235125,1235117,1234444,1235113,1235039,1235030,1235015,1235011,1235006,1234979,1234968,1234959,1234959,1234957,1234953,1234924,1234923,1234918,1234916,1234898,1234895,1234893,1234892,1234870,1234864,1234861,1234836,1234833,1234830,1234785,1234760,1234719,1233841,1234671,1234648,1234647,1234636,1234627,1234622,1234619,1234549,1234504,1234491,1234483,1234482,1234438,1234392,1234384,1234363,1234361,1234360,1234359,1234337,1234330,1234307,1234297,1234280,1234276,1234275,1234271,1234269,1234251,1234249,1234239,1234239,1234232,1234228,1234227,1234213,1234211,1234206,1234200,1234198,1234195,1234195,1234195,1234172,1234151,1234112,1234088,1234071,1234065,1234063,1234057,1234037,1234031,1234019,1233983,1233983,1233928,1233900,1233876,1233859,1233841,1233841,1233841,1233841,1233792,1233773,1233769,1233755,1233732,1233725,1233705,1233705,1233699,1233686,1233673,1233621,1233615,1233614,1233610,1233597,1233588,1233564,1233553,1233540,1233513,1233510,1233481,1233478,1233416,1233402,1233395,1233390,1233390,1233378,1233365,1233359,1233337,1233329,1233258,1233230,1233203,1233180,1233180,1233176,1233169,1233168,1233121,1233118,1233082,1227227,1233075,1233045,1233025,1232999,1232995,1232989,1232986,1232972,1232953,1232950,1232927,1232916,1232896,1232877,1232877,1232867,1232865,1232858,1232850,1232839,1232836,1232836,1232832,1232832,1232821,1232816,1232780,1232742,1232746,1232739,1232737,1232736,1232724,1232665,1232646,1232639,1232609,1232608,1232596,1232591,1232591,1232591,1232582,1232568,1232555,1232555,1232555,1232547,1232509,1232506,1232504,1232499,1232387,1232381,1232378,1232324,1232319,1232317,1232287,1232284,1232278,1232273,1232238,1232238,1232218,1232197,1232177,1232166,1232142,1232137,1232122,1232118,1232103,1232096,1232074,1232072,1232059,1232036,1232007,1232001,1231999,1231981,1231964,1231952,1231940,1231939,1231932,1231915,1231912,1231910,1231900,1231899,1231884,1231884,1231884,1231878,1231870,1231849,1231842,1231822,1231811,1231811,1231811,1231794,1231781,1231768,1231751,1231737,1231671,1231651,1231624,1231567,1231554,1231540,1231451,1231375,1231375,1231375,1231334,1231320,1231320,1231320,1231317,1231315,1231310,1231288,1231261,1231250,1231240,1231237,1231223,1231214,1231206,1231199,1231198,1231191,1231186,1231180,1231152,1231147,1231135,1231119,1228962,1231075,1231068,1231059,1229305,1231031,1231021,1231021,1231021,1231019,1231005,1231002,1230988,1230916,1230909,1230901,1230893,1230877,1229065,1230864,1230857,1230836,1230819,1230810,1230799,1230746,1230739,1230735,1230731,1230729,1230721,1230720,1230711,1230683,1230681,1230679,1230669,1230661,1230655,1230652,1230640,1230592,1230590,1230582,1230572,1230561,1230554,1230519,1230508,1230492,1230489,1230465,1230459,1230444,1230444,1230436,1230415,1230415,1230412,1230412,1230412,1230371,1230360,1230343,1230342,1230335,1230309,1230309,1230294,1230288,1230274,1230265,1230263,1230262,1230256,1230252,1230245,1230237,1230230,1230186,1230185,1230180,1230177,1230175,1230137,1230116,1230090,1230081,1230080,1230063,1230061,1230051,1230044,1230030,1230030,1230011,1229977,1229966,1229962,1229959,1229938,1229905,1229902,1229902,1229899,1229882,1229852,1229849,1229832,1229831,1229789,1229784,1229782,1229756,1229749,1229747,1229733,1229718,1229717,1229701,1229636,1229618,1229548,1229537,1229525,1229496,1229490,1229484,1229471,1229462,1229455,1229453,1229430,1229411,1229396,1229392,1229384,1229374,1229344,1229337,1229312,1229297,1229294,1229286,1229285,1229269,1229268,1229267,1229226,1229202,1229202,1229202,1229189,1229180,1229171,1229154,1229150,1229139,1229140,1229110,1229102,1229098,1229086,1229074,1229074,1229060,1229043,1229012,1229007,1229005,1228984,1228973,1228961,1228956,1228947,1228934,1228921,1228918,1228913,1228907,1228888,1228878,1228843,1228828,1228823,1228820,1228786,1228771,1228755,1228729,1228729,1228716,1228699,1228688,1228657,1228649,1228599,1228584,1228564,1228548,1223688,1228513,1228499,1228478,1228475,1228469,1228457,1228454,1228427,1228425,1228424,1228409,1228308,1222112,1228304,1228304,1228304,1222301,1228294,1228285,1228262,1228251,1228248,1228241,1228214,1228211,1228199,1228199,1228199,1228184,1228177,1228174,1228148,1228146,1228142,1228117,1228118,1228106,1228078,1228078,1228041,1228041,1228034,1228034,1228035,1228030,1228008,1227984,1227983,1227983,1227981,1227981,1227972,1227945,1227939,1227928,1227904,1227880,1227870,1227861,1227854,1227844,1227835,1227806,1227779,1227742,1227735,1227727,1227713,1227706,1227706,1227682,1227680,1227619,1227619,1227619,1227620,1227616,1227592,1227579,1227558,1227557,1227541,1227540,1227537,1227533,1227528,1227500,1227482,1227482,1227482,1227435,1227435,1227424,1227413,1227376,1227359,1227352,1227345,1227345,1227331,1227315,1227310,1227309,1227304,1227300,1227298,1227287,1227269,1227250,1227245,1227230,1227200,1227200,1227184,1227168,1227164,1227161,1227132,1227121,1227092,1227092,1227090,1227089,1227087,1227077,1227060,1227058,1227058,1227019,1227008,1226991,1226964,1226931,1226930,1226910,1226909,1226882,1226881,1226864,1226816,1226786,1226750,1226739,1226734,1226734,1226658,1226646,1226590,1226548,1226535,1226531,1226517,1226510,1226501,1226475,1226470,1226457,1226431,1226421,1226420,1226414,1226402,1226384,1226379,1226365,1226361,1226360,1226357,1226356,1226351,1226344,1226338,1226332,1226312,1226312,1226312,1226312,1226277,1226273,1226272,1226266,1226256,1226237,1226222,1226218,1226186,1226170,1226160,1226134,1226083,1226053,1226019,1226003,1225986,1225919,1225879,1225863,1225849,1225831,1225813,1225796,1225785,1225759,1225756,1225735,1225735,1225735,1225730,1225716,1225677,1225669,1225659,1225649,1225619,1225585,1225583,1225559,1225559,1225538,1225511,1225503,1225427,1225407,1225396,1225298,1225278,1225200,1225200,1225197,1225190,1225178,1225150,1225111,1225110,1225092,1225080,1225064,1225062,1225061,1225021,1224962,1224957,1224945,1224930,1224857,1224837,1224811,1224802,1224796,1224791,1224791,1224790,1224788,1224774,1224773,1224773,1224773,1224766,1224755,1224730,1224727,1224726,1224691,1224659,1224638,1224638,1224619,1224577,1224568,1224547,1224521,1224464,1224428,1224419,1224409,1224378,1224345,1224328,1224276,1224273,1224244,1224210,1224151,1224139,1224112,1224109,1224106,1224102,1224075,1224075,1224069,1224032,1224024,1224016,1224013,1224002,1223993,1223977,1223976,1223975,1223962,1223962,1223920,1223910,1223894,1223886,1223860,1223860,1223856,1223846,1223800,1223789,1223777,1223764,1223760,1223688,1223669,1223650,1223638,1223614,1223612,1223597,1223591,1223580,1223580,1223580,1223576,1223554,1223496,1223493,1223486,1223471,1223432,1223432,1223409,1223395,1223389,1223388,1223378,1223377,1223367,1223363,1223351,1223230,1223219,1223201,1223200,1223182,1223182,1223175,1223173,1223173,1223168,1223153,1223146,1223109,1223100,1223089,1223062,1223060,1223049,1223018,1222998,1222996,1222996,1222981,1222933,1222928,1222923,1222918,1222880,1222806,1222791,1222774,1222742,1222734,1222730,1222725,1222721,1222714,1222671,1222660,1222654,1222654,1222591,1222591,1222591,1222570,1222555,1222541,1222530,1222526,1222509,1222491,1222485,1222478,1222472,1222470,1222450,1222436,1222425,1222423,1222411,1222393,1222342,1222323,1222322,1222316,1222273,1222235,1222227,1222194,1222158,1222133,1222127,1222100,1222061,1222034,1221981,1221974,1221967,1221924,1221922,1221908,1221893,1221877,1221877,1221877,1221872,1221796,1221796,1221778,1221777,1221711,1221704,1221690,1221665,1221647,1221643,1221632,1221630,1221608,1221606,1221587,1221573,1221569,1221552,1221514,1221479,1221458,1221456,1221448,1221424,1221421,1221408,1221401,1221398,1221360,1221295,1221281,1221274,1221273,1221220,1221215,1221212,1221207,1221203,1221162,1221144,1221140,1221117,1221104,1221078,1221074,1221048,1221041,1221035,1221030,1220975,1220957,1220927,1220912,1220894,1220808,1220805,1220770,1220748,1220748,1220737,1220726,1220726,1220726,1220721,1220715,1220683,1191607,1191607,1220620,1220587,1220574,1220515,1220503,1220489,1220480,1220469,1220460,1220380,1220374,1220366,1220364,1220345,1220338,1220333,1220304,1220273,1220175,1220171,1220154,1220132,1220125,1220116,1220077,1220038,1220016,1219985,1219985,1219985,1219899,1219866,1219860,1219841,1219836,1219797,1219774,1219720,1219711,1219693,1219688,1219684,1219644,1219632,1219612,1219600,1219592,1219584,1219577,1219571,1219566,1219561,1219560,1219501,1219496,1219486,1219465,1219375,1219371,1219340,1219326,1219323,1219323,1219317,1219314,1219310,1219307,1219292,1219271,1219271,1219271,1219270,1219266,1219228,1219227,1219176,1219168,1219166,1219141,1219114,1219080,1219062,1219052,1219045,1219040,1219039,1219021,1218963,1218950,1218915,1218888,1218869,1218860,1218804,1218781,1218732,1218731,1218727,1218703,1218697,1218688,1218679,1218670,1218659,1218652,1218642,1218616,1218556,1218542,1218533,1218519,1218512,1218502,1218490,1218455,1218424,1218419,1218405,1218404,1218380,1218380,1218379,1218377,1218371,1218344,1218314,1218309,1218305,1218290,1218268,1218251,1218226,1218203,1218188,1218174,1218158,1218131,1218117,1218111,1218062,1218047,1218025,1218006,1218006,1218006,1217977,1217941,1217924,1217913,1217914,1217902,1217896,1217891,1217866,1217835,1217822,1217804,1217789,1217782,1217761,1217612,1217580,1215594,1217479,1217462,1217409,1217397,1217351,1217342,1217336,1217313,1217311,1217308,1217280,1217182,1217150,1217134,1214000,1217103,1217102,1217096,1217082,1217070,1217068,1217048,1217043,1217036,1217027,1216995,1216993,1216896,1216876,1216872,1216872,1216858,1216822,1216820,1216771,1216739,1216728,1216721,1216693,1216680,1216670,1216652,1216652,1216630,1216613,1216612,1216584,1216581,1216551,1216546,1216535,1216515,1216481,1216471,1216437,1216422,1216417,1216407,1216401,1216365,1216344,1216312,1216308,1216232,1216216,1216215,1216172,1216143,1216134,1216057,1216049,1216028,1216006,1215989,1215980,1215953,1215939,1215937,1215893,1215893,1215882,1215881,1215867,1215862,1215842,1215840,1215830,1215823,1215801,1215783,1215757,1215737,1215737,1215737,1215729,1215724,1215704,1215688,1215675,1215636,1215610,1215604,1215601,1215594,1215592,1215588,1215568,1215524,1215511,1215422,1215409,1215396,1215383,1215358,1215338,1215312,1215305,1215264,1215231,1215220,1215202,1215051,1215029,1215018,1215000,1214999,1214935,1214926,1214923,1214840,1214836,1214836,1214753,1214742,1211543,1214678,1214618,1214553,1214533,1214478,1214478,1214467,1214464,1214451,1214432,1214422,1214418,1214417,1214412,1214410,1214408,1214401,1214391,1214391,1214391,1214390,1214312,1214312,1214273,1214263,1214246,1214238,1214220,1214187,1214181,1214181,1214115,1214080,1214073,1214013,1214000,1214000,1214000,1214000,1213973,1213947,1213899,1213885,1213880,1213881,1213842,1213841,1213833,1213833,1213805,1213777,1213773,1213767,1213767,1213732,1213702,1213650,1213609,1213596,1213575,1213573,1213573,1213562,1213560,1213521,1213493,1213493,1213443,1213437,1213422,1213407,1213377,1213369,1213368,1213347,1213337,1213329,1213318,1213294]
        global response
        sno=0

        for ids in inputIdList:

            page_query = "query{"
            page_query += "orderById(id: "+str(ids)+ "){id createdOn status items(first:100){edges{node{ref quantity price}}}fulfilments(first:100){edges{node{id status items(first:100){edges{node{ref}}}}}}}}"

            client = GraphQLClient(graphql_url)
            token = get_token()
            client.inject_token(token)
            response = client.execute(page_query)
            response = json.loads(response)
            #print(response)

            if response is not None:
                sno=sno+1
                print(sno)
                with open('testing.csv','a') as f, open('output.csv','a') as output:


                    orderSKU=[]
                    FulfilmentSKU=[]
                    quantity=[]
                    price=[]

                    f.write(str(sno)+','+response['data']['orderById']['id']+'\n')

                    n=len(response['data']['orderById']['items']['edges'])
                    for k in range(0,n):
                        f.write(','+','+response['data']['orderById']['items']['edges'][k]['node']['ref']+'\n')
                        orderSKU.append(response['data']['orderById']['items']['edges'][k]['node']['ref'])
                        quantity.append(response['data']['orderById']['items']['edges'][k]['node']['quantity'])
                        price.append(response['data']['orderById']['items']['edges'][k]['node']['price'])

                    o=len(response['data']['orderById']['fulfilments']['edges'])

                    for l in range(0,o):
                        f.write(','+','+','+response['data']['orderById']['fulfilments']['edges'][l]['node']['id'])
                        f.write(','+response['data']['orderById']['fulfilments']['edges'][l]['node']['status']+'\n')


                        p=len(response['data']['orderById']['fulfilments']['edges'][l]['node']['items']['edges'])

                        for mm in range(0,p):
                            f.write(','+','+','+','+','+response['data']['orderById']['fulfilments']['edges'][l]['node']['items']['edges'][mm]['node']['ref']+'\n')
                            FulfilmentSKU.append(response['data']['orderById']['fulfilments']['edges'][l]['node']['items']['edges'][mm]['node']['ref'])

                        # if(len(set(orderSKU).symmetric_difference(set(FulfilmentSKU)))==0):
                        #     f.write(','+','+','+','+','+'All SKUs present'+'\n')
                        # else:
                        #     f.write(','+','+','+','+','+str(set(orderSKU).symmetric_difference(set(FulfilmentSKU)))+'\n')

                    if(len(orderSKU)>len(FulfilmentSKU)):
                        f.write(','+','+','+','+','+','+'Unassigned Items'+','+str(set(orderSKU).symmetric_difference(set(FulfilmentSKU)))+'\n')
                    elif(len(orderSKU)<len(FulfilmentSKU)):
                        f.write(','+','+','+','+','+','+'Alert check'+','+str(set(FulfilmentSKU).symmetric_difference(set(orderSKU)))+'\n')
                    else:
                        f.write(','+','+','+','+','+','+'All SKU assigned'+','+str(set(FulfilmentSKU).symmetric_difference(set(orderSKU)))+'\n')




f.close()
output.close()

start = time.time()

get_all_data()

print("Time taken: " + str((time.time()-start)/60) + " minutes")
